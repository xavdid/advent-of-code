---
import Layout from "../layouts/Layout.astro";
import { Content as WelcomeContent } from "../components/Welcome.md";
import { Content as AboutContent } from "../components/About.md";

import { getWriteupsByYear } from "../utils/collections";

const NUM_RECENT_POSTS = 3;

const posts = await getWriteupsByYear();

const recentYears = [...posts.keys()]
  .toSorted((a, b) => a - b)
  .slice(-NUM_RECENT_POSTS);
const thisYearsPosts = posts.get(recentYears.at(-1) ?? 0);
if (!thisYearsPosts) {
  throw new Error("missing posts!");
}
const showEllipse = Number(thisYearsPosts?.length) > NUM_RECENT_POSTS;
const newestPosts = thisYearsPosts
  ?.toSorted((a, b) => a.data.day - b.data.day)
  .slice(-NUM_RECENT_POSTS);

// designed using
// https://tree.nathanfriend.com/?s=(%27options!(%27fancy!true~fullPath5~trailingSlash5~rootDot5)~6(%276%27%2C%278writeups*...727374*-Day%201%27)~version!%271%27)*8--%20%205!false6source!7*2028%5Cn-%018765-*
---

<Layout>
  <WelcomeContent />
  <pre>~
└── <a href="/writeups">writeups</a>
    ├── ...
{recentYears.map((year, index) => (
  <>
    {`    ${index === (NUM_RECENT_POSTS - 1) ? '└' : '├'}── `}
    <a href={`/writeups/${year}`}>{year}</a><br />{
      index === (NUM_RECENT_POSTS - 1) &&
      (
        <>
        {showEllipse && <div>{"        ├── ..."}</div> }
        {newestPosts?.map((post, postIndex) => (
          <>
            {postIndex === newestPosts.length-1 ? "        └── " : "        ├── "}
            <a href={`/writeups/${post.slug}`}>Day {post.data.day}</a></><br />
        ))}
        </>
      )
    }
  </>
))}</pre>
  <AboutContent />
</Layout>
